/home/cetec/AIProjects/mueva_test/muvera_test.py:78: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
ğŸš€ Iniciando Debug de RecuperaciÃ³n con IMAGEN...
âœ… LangSmith configurado

================================================================================
ğŸš€ SISTEMA RAG HISTOPATOLOGÃA - ColPali PURO + MUVERA + LangGraph
================================================================================

ğŸ–¼ï¸ Inicializando ColPali Puro + MUVERA...
   ğŸ“š Cargando ColPali v1.2 (texto + imÃ¡genes)...
Fetching 2 files:   0%|          | 0/2 [00:00<?, ?it/s]Fetching 2 files: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2/2 [00:00<00:00, 16743.73it/s]
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 1/2 [00:03<00:03,  3.64s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2/2 [00:04<00:00,  1.78s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 2/2 [00:04<00:00,  2.06s/it]
Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.52, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
   âœ… ColPali cargado (128D multi-vector)
   ğŸš€ Inicializando MUVERA...
   âœ… MUVERA inicializado (FDE: 20480D)
ğŸ–¼ï¸ Usando imagen: uploads/query_image_d2a978a7a73e427db0a93e0f6de4f23e.jpg


ğŸ” CONSULTA MULTIMODAL: 'analiza esta imagen histologica y dime que organo es' + IMAGEN

ğŸ“¨ Recibiendo consulta: analiza esta imagen histologica y dime que organo ...

ğŸ” Ejecutando bÃºsqueda en Qdrant...
ğŸ”— Cliente Qdrant conectado

ğŸ“„ Resultados recuperados (5):
   [1] Score: 668.5834 | Doc: unknown (Pg ?)
       Imagen: histopatologia_data/embeddings/arch2_page_3.jpg
   [2] Score: 665.8362 | Doc: unknown (Pg ?)
       Imagen: histopatologia_data/embeddings/arch2_page_5.jpg
   [3] Score: 640.3456 | Doc: unknown (Pg ?)
       Imagen: histopatologia_data/embeddings/arch2_page_14.jpg
   [4] Score: 638.4885 | Doc: unknown (Pg ?)
       Imagen: histopatologia_data/embeddings/arch2_page_15.jpg
   [5] Score: 633.8242 | Doc: unknown (Pg ?)
       Imagen: histopatologia_data/embeddings/arch2_page_8.jpg

ğŸ’­ Generando respuesta multimodal...
   âœ… Respuesta generada

--------------------------------------------------
ğŸ¤– RESPUESTA FINAL DEL AGENTE:
Â¡Excelente consulta! Como su profesor de histopatologÃ­a, vamos a analizar esta imagen con el rigor y la precisiÃ³n que requiere.

BasÃ¡ndome en la imagen histolÃ³gica proporcionada, el Ã³rgano que estamos observando es la **TrÃ¡quea** o un **Bronquio principal (de gran calibre)**.

### AnÃ¡lisis HistolÃ³gico Detallado y JustificaciÃ³n

Para un estudiante de medicina, es crucial identificar las caracterÃ­sticas clave que nos llevan a este diagnÃ³stico. Observemos la imagen con atenciÃ³n:

1.  **Epitelio (Capa mÃ¡s superficial):**
    *   **Tipo:** Lo primero que salta a la vista es el epitelio que recubre la luz del Ã³rgano. Se trata de un **epitelio pseudoestratificado cilÃ­ndrico ciliado con cÃ©lulas caliciformes**.
        *   **Pseudoestratificado:** Aunque los nÃºcleos de las cÃ©lulas se encuentran a diferentes niveles, dando la impresiÃ³n de varias capas, todas las cÃ©lulas contactan con la membrana basal. Esto es una caracterÃ­stica distintiva de las vÃ­as respiratorias.
        *   **CilÃ­ndrico:** La forma predominante de las cÃ©lulas es columnar o cilÃ­ndrica.
        *   **Ciliado:** En la superficie apical de las cÃ©lulas cilÃ­ndricas, se observan claramente los **cilios**, pequeÃ±as proyecciones mÃ³viles que son esenciales para el movimiento del moco y las partÃ­culas atrapadas hacia la faringe (el "escalador mucociliar").
        *   **CÃ©lulas Caliciformes:** Dispersas entre las cÃ©lulas ciliadas, se aprecian cÃ©lulas pÃ¡lidas, con forma de cÃ¡liz o copa, que son las **cÃ©lulas caliciformes**. Estas cÃ©lulas son glÃ¡ndulas unicelulares especializadas en la producciÃ³n y secreciÃ³n de moco.
    *   **FunciÃ³n:** Este epitelio es la primera lÃ­nea de defensa del sistema respiratorio, atrapando partÃ­culas y patÃ³genos en el moco y expulsÃ¡ndolos gracias a la acciÃ³n coordinada de los cilios.

2.  **LÃ¡mina Propia y Submucosa (Debajo del Epitelio):**
    *   Inmediatamente debajo del epitelio, encontramos una capa de tejido conectivo laxo, rica en vasos sanguÃ­neos y cÃ©lulas inmunes, que constituye la lÃ¡mina propia.
    *   Lo mÃ¡s distintivo en esta regiÃ³n son las **glÃ¡ndulas seromucosas (o glÃ¡ndulas traqueales/bronquiales)**. Se observan mÃºltiples acinos glandulares, algunos con secreciÃ³n mÃ¡s pÃ¡lida (mucosa) y otros con secreciÃ³n mÃ¡s basÃ³fila (serosa). Estas glÃ¡ndulas son tubuloacinares compuestas y contribuyen significativamente a la producciÃ³n del moco que recubre el epitelio, manteniÃ©ndolo hÃºmedo y facilitando la captura de partÃ­culas.

3.  **Ausencia de CartÃ­lago en esta Vista:**
    *   Es importante seÃ±alar que, en esta vista particular de la imagen, no se observa el cartÃ­lago hialino que es caracterÃ­stico de la trÃ¡quea (anillos en forma de "C") o de los bronquios principales (placas irregulares). Sin embargo, la combinaciÃ³n del epitelio respiratorio pseudoestratificado ciliado con cÃ©lulas caliciformes y la presencia abundante de glÃ¡ndulas seromucosas en la submucosa es **patognomÃ³nica** de las vÃ­as aÃ©reas conductoras de gran calibre.

### ConclusiÃ³n y DiferenciaciÃ³n

La presencia de **epitelio pseudoestratificado cilÃ­ndrico ciliado con cÃ©lulas caliciformes** y **glÃ¡ndulas seromucosas en la submucosa** son las caracterÃ­sticas diagnÃ³sticas clave que nos permiten identificar este Ã³rgano como parte del sistema respiratorio conductor, especÃ­ficamente la **trÃ¡quea** o un **bronquio principal**.

*   **TrÃ¡quea vs. Bronquio Principal:** La distinciÃ³n entre trÃ¡quea y un bronquio principal a menudo se basa en la morfologÃ­a del cartÃ­lago (anillos en "C" en la trÃ¡quea vs. placas irregulares en los bronquios) y la presencia de una capa de mÃºsculo liso mÃ¡s prominente en los bronquios. Dado que el cartÃ­lago no es visible en esta imagen, no podemos hacer una distinciÃ³n absoluta, pero ambas opciones son correctas basÃ¡ndonos en las caracterÃ­sticas presentes.

### IntegraciÃ³n con InformaciÃ³n Adicional

He revisado los "DOCUMENTOS Y CONTEXTOS RECUPERADOS" que se proporcionaron (imÃ¡genes y textos relacionados con el aparato genital, como el cuerpo lÃºteo o el endometrio). Es importante destacar que esta informaciÃ³n **no es relevante** para el anÃ¡lisis de la imagen histolÃ³gica de la trÃ¡quea/bronquio. Mi anÃ¡lisis se basa exclusivamente en las caracterÃ­sticas morfolÃ³gicas observadas en la imagen de consulta.

Espero que este anÃ¡lisis detallado le sea de gran utilidad para comprender la histologÃ­a de las vÃ­as respiratorias. Â¡Siga practicando la identificaciÃ³n de estas estructuras clave!
--------------------------------------------------
Exception ignored in: <_io.BufferedWriter name=28>
BrokenPipeError: [Errno 32] Broken pipe
